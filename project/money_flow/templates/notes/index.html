{% extends 'base.html' %}

{% block title %} –ì–ª–∞–≤–Ω–∞—è {% endblock %}

{% block content %}

<div class="container mt-5">
    <h2 class="mb-4">–°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π</h2>
    <form method="get">
      <input type="date" name="date_from" value="{{ request.GET.date_from }}">
      <input type="date" name="date_to" value="{{ request.GET.date_to }}">
  
      <select name="status">
        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
        {% for s in statuses %}
            <option value="{{ s.id }}" {% if request.GET.status == s.id|stringformat:"s" %}selected{% endif %}>{{ s.name }}</option>
        {% endfor %}
    </select>
  
      <select name="type">
          <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
          {% for t in types %}
              <option value="{{ t.id }}" {% if request.GET.type == t.id|stringformat:"s" %}selected{% endif %}>{{ t.name }}</option>
          {% endfor %}
      </select>
  
      <select name="main_category">
          <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
          {% for cat in main_categories %}
              <option value="{{ cat.id }}" {% if request.GET.main_category == cat.id|stringformat:"s" %}selected{% endif %}>{{ cat.name }}</option>
          {% endfor %}
      </select>
  
      <select name="category">
          <option value="">–í—Å–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
          {% for cat in categories %}
              <option value="{{ cat.id }}" {% if request.GET.category == cat.id|stringformat:"s" %}selected{% endif %}>{{ cat.name }}</option>
          {% endfor %}
      </select>
  
      <button type="submit">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
  </form>

    <table class="table table-bordered table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–¢–∏–ø</th>
          <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
          <th>–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</th>
          <th>–°—É–º–º–∞</th>
          <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
          <th>–°–æ–∑–¥–∞–Ω–æ</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody>
        {% for note in notes %}
          <tr>
            <td>{{ note.status }}</td>
            <td>{{ note.type }}</td>
            {% if note.category.parent %}
            <td>{{ note.category.parent }}</td>
            <td>{{ note.category}}</td>
            {% else %}
            <td>{{ note.category }}</td>
            <td>‚Äî</td>
            {% endif %}
            <td>{{ note.total_sum }}</td>
            <td>{{ note.comment|default:"‚Äî" }}</td>
            <td>{{ note.created_at|date:"d.m.Y" }}</td>
            <td>
              <a href="{% url 'note_update' note.id %}" class="btn btn-sm btn-primary">‚úèÔ∏è</a>
              <a href="{% url 'note_delete' note.id %}" class="btn btn-sm btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ note.id }}">üóëÔ∏è</a>

            <div class="modal fade" id="deleteModal{{ note.id }}" tabindex="-1" aria-labelledby="deleteModalLabel{{ note.id }}" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <form method="post" action="{% url 'note_delete' note.id %}">
                      {% csrf_token %}
                      <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel{{ note.id }}">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
                      </div>
                      <div class="modal-body">
                        –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ <strong>"{{ note }}"</strong>?
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="6" class="text-center">–ó–∞–ø–∏—Å–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}